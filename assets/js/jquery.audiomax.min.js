(function(e){e.audiomax=function(t,n){function i(){var t=e("<ul></ul>",{id:"playlist"});var n=r.options.playlist;var i=0;for(i;i<n.length;i++){t.append("<li>"+n[i]["interpreter"]+" - "+(n[i]["album"]!=""?n[i]["album"]+" - ":"")+(n[i]["track"]!=""?n[i]["track"]+" - ":"")+n[i]["title"])}t.children("li:first-child").attr("data-current","true").addClass("active");return t}function s(){var t=e("<ul></ul>",{id:"controls"});var n=r.options.controls;for(key in n){var i=e("<li></li>",{"data-controls":key,text:n[key],title:n[key]});t.append(i)}t.children('li[data-controls="play"]').attr("data-state","null");t.children('li[data-controls="volume"]').attr("data-state","volumeOn");return t}function o(){var t=e("<div></div>",{id:"volume"});var n=e("<meter></meter>",{min:0,max:1,value:r.options.initVolume});t.append(n);t.append("<span>"+u(r.options.initVolume)+"</span>");return t}function u(e){return parseInt(e*100)+"%"}function a(t){var n;var r=e("#volume meter").width();n=t*100/r/100;n=new String(n);return n.slice(0,4)}function f(){var t=e("<div></div>",{id:"playerInfo"});var n=e("<progress></progress>",{min:0,max:1,value:0});t.append(n);t.append("<span>"+c(0)+"</span>");return t}function l(t){var n,i,s,o;var u=e("#playerInfo progress").width();if(t==undefined){i=r.audio.currentTime/r.audio.duration}else{i=t*100/u/100}s=r.audio.duration*i;o={currentTime:s,played:i};return o}function c(e){var t=new Date(e*1e3);var n=("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2);return n}function h(e,t){var n=t.pageX-e.offset()["left"];return n}var r=this;r.$el=e(t);r.$elInner=r.$el.children(".inside");r.el=t;r.$el.data("audiomax",r);r.currentAudio=0;r.init=function(){r.options=e.extend({},e.audiomax.defaultOptions,n);if(r.options.title!=="null"){r.$elInner.append('<div class="playlistTitle">'+r.options.title+"</div>")}if(r.options.description!=="null"){r.$elInner.append('<div class="playlistDescription">'+r.options.description+"</div>")}if(r.options.playlist!==null&&typeof r.options.playlist==="object"){r.$elInner.append(i())}r.$elInner.append(f());r.$elInner.append(s());r.$elInner.append(o());r.audioCreate(r.getTrackIndex("current"));r.audio.volume=r.options.initVolume};r.audioCreate=function(e){r.audio=new Audio;var t=r.options.playlist[e]["files"];for(var n in t){if(r.audio.canPlayType(t[n]["type"])!=""&&r.audio.canPlayType(t[n]["type"])!="no"){r.audio.src=t[n]["file"];break}}r.audio.preload=r.options.preload};r.audioPlay=function(){r.audio.play();e('#controls li[data-controls="play"]').attr("data-state","play");r.audio.addEventListener("timeupdate",function(){var t=c(r.audio.currentTime);var n=e("#playerInfo progress");n.next().text(t);var i=l();n.val(i.played)});r.audio.addEventListener("ended",function(){r.audioCreate(r.getTrackIndex("next"));r.audioPlay()})};r.audioPause=function(){r.audio.pause();e('#controls li[data-controls="play"]').attr("data-state","pause")};r.setCurrentStatus=function(t){e("#playlist li").removeAttr("data-current").removeClass("active");t.attr("data-current","true").addClass("active")};r.audioVolume=function(e,t){var n=a(h(e,t));e.attr("value",n);e.next().text(u(n));r.audio.volume=n};r.audioToggle=function(t){var n=e("#volume meter");if(t=="on"){r.audio.volume=r.currentVolume;n.next().text(u(r.currentVolume));console.log(r.currentVolume);n.attr("value",r.currentVolume)}else if(t=="off"){r.currentVolume=r.audio.volume;r.audio.volume=0;n.next().text(u(0));n.attr("value",0)}};r.audioProgress=function(e,t){var n=l(h(e,t));e.attr("value",n["played"]);e.next().text(c(n["currentTime"]));r.audio.currentTime=n["currentTime"]};r.getTrackIndex=function(e){var t;var n;if(e=="current"){n=r.$el.find('li[data-current="true"]')}else if(e=="next"){n=r.$el.find('li[data-current="true"]').next();if(n.length==0){n=r.$el.find("#playlist li:first-child")}}else if(e=="prev"){n=r.$el.find('li[data-current="true"]').prev();if(n.length==0){n=r.$el.find("#playlist li:last-child")}}r.setCurrentStatus(n);t=n.index();return t};r.init()};e.audiomax.defaultOptions={title:"null",playlist:"null",preload:"auto",description:"null",controls:{prev:"previous",play:"play/pause",next:"next",volume:"Sound on/off"},initVolume:.6};e.fn.audiomax=function(t){return this.each(function(){var n=new e.audiomax(this,t);e('#controls li[data-controls="play"]').click(function(){var t=e(this);var r=t.attr("data-state");if(r==null||r=="null"||r=="pause"){n.audioPlay()}else if(r=="play"){n.audioPause()}});e('#controls li[data-controls="next"]').click(function(){var t=e(this);if(typeof n.audio==="object"){n.audioPause()}n.audioCreate(n.getTrackIndex("next"));n.audioPlay()});e('#controls li[data-controls="prev"]').click(function(){var t=e(this);if(typeof n.audio==="object"){n.audioPause()}n.audioCreate(n.getTrackIndex("prev"));n.audioPlay()});e("#playlist li").click(function(t){var r=e(this);n.setCurrentStatus(r);if(typeof n.audio==="object"){n.audioPause()}n.audioCreate(n.getTrackIndex("current"));n.audioPlay()});e("#playerInfo progress").click(function(t){var r=e(this);n.audioProgress(r,t)});e("#volume meter").click(function(t){var r=e(this);n.audioVolume(r,t)});e('#controls li[data-controls="volume"]').click(function(){var t=e(this);var r=t.attr("data-state");if(r=="volumeOn"){n.audioToggle("off");t.attr("data-state","volumeOff")}else if(r=="volumeOff"){n.audioToggle("on");t.attr("data-state","volumeOn")}})})}})(jQuery)